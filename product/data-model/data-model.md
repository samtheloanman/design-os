# Data Model

## Single Source of Truth: Program Entity

All programs (national and local) are stored as a single **Program** entity using the `group_programs_consolidated` ACF field group. The `is_local_variation` toggle determines whether the program is national or location-specific.

---

## Entities

### Program
**WordPress CPT:** `program`
**ACF Field Group:** `group_programs_consolidated` — **CANONICAL FIELD GROUP FOR ALL PROGRAMS**
**Schema.org:** FinancialProduct + LoanOrCredit

A mortgage product that can be national (shown across all pages) or local (tailored for a specific city/region). All pages use this single Program entity and its ACF data.

#### Structure & Tabs

The Programs field group is organized into tabs for better UX:

1. **Location Information** (conditional: shown when `is_local_variation` = true)
2. **Program Information** (always visible)
3. **Financial Terms**
4. **Program Details**
5. **Property & Loan Details**
6. **Borrower Details**

---

#### Tab 1: Location Information
*Visible only when `is_local_variation` = true*

- `is_local_variation` (true_false) - Master toggle: "Check if this is a local/city-specific variation of a program"
- `keyword` (text) - SEO keyword (auto-generated by Page Generator Pro)
- `city_name` (text) - City name (auto-generated)
- `county_name` (text) - County name (auto-generated)
- `region_name` (text) - Region name (auto-generated)
- `region_code` (text) - Region code (auto-generated)
- `zip_code` (textarea) - Zip codes served (auto-generated)
- `city_latitude` (text) - City latitude (auto-generated)
- `city_longitude` (text) - City longitude (auto-generated)
- `city_median_household_income` (text) - Median household income (auto-generated)
- `city_population` (text) - Total population
- `city_population_male` (text) - Male population count
- `city_population_male_percent` (text) - Male population %
- `city_popluation_female` (text) - Female population count (note: typo in ACF field name)
- `city_population_female_percent` (text) - Female population %
- `city_population_children` (text) - Children population count
- `city_population_children_percent` (text) - Children population %
- `city_population_adults` (text) - Adults population count
- `city_population_adults_percent` (text) - Adults population %
- `city_population_elderly` (text) - Elderly population count
- `city_population_elderly_percent` (text) - Elderly population %
- `yoast_location_id` (text) - Yoast SEO location ID
- `local_cmre_address` (acfe_address) - Physical address for local office/service area

---

#### Tab 2: Program Information
*Always visible — Core program definition*

- `name` (wysiwyg, required) - Program name/title
- `program_type` (select, required) - Main program category:
  - Residential
  - Commercial
  - NonQM Stated No Doc No income
  - Hard Money
  - Reverse Mortgage
  - Construction
  - Land
  - Jumbo Residential
  - Super Jumbo Residential
  - Commercial Super Jumbo
  - 2nd Mortgage HELOAN HELOC
  - 2nd Mortgage NonQM Stated No Doc No income

**Conditional Sub-Type Fields:**

- `residential` (select multiple) - *Show when `program_type` = "Residential"*
  - Conforming Conventional, FHA, VA, FHA 203k, USDA, VA IRRRL, etc. (34+ options)
- `commercial` (select multiple) - *Show when `program_type` = "Commercial" or "Commercial Super Jumbo"*
  - Conventional, SBA, Fannie/Freddy, Construction, Hard Money, SBA 504, SBA 7a, etc. (13+ options)
- `hard_money` (select multiple) - *Show when `program_type` = "Hard Money"*
  - Private Equity, Fix and Flip, Rental Fix and Hold, Ground up Residential/Commercial Construction, Vacant Land
- `nonqm_stated_no_doc_no_income` (select) - *Show when `program_type` = "NonQM Stated No Doc No income"*
  - 1099, Community, DSCR, Bank Statements, 1 YR Income, P&L, Asset Depletion, VOE Only, Foreign National, Portfolio loans, NINA, NONI, SISA, Hard Money
- `reverse_mortgage` (select multiple) - *Show when `program_type` = "Reverse Mortgage"*
  - HomeSafe FOA, HomeSafe FOA 2nd, HECM Home Equity Conversion

**Program Highlights:**
- `mortgage_program_highlights` (wysiwyg) - Key features and benefits of this program

---

#### Tab 3: Financial Terms

- `interest_rates` (wysiwyg) - Range of available interest rates
- `minimum_loan_amount` (wysiwyg) - Minimum loan amount for this program
- `maximum_loan_amount` (wysiwyg) - Maximum loan amount for this program
- `min_credit_score` (number) - Minimum credit score required
- `max_ltv` (text) - Maximum loan-to-value ratio (e.g., 80%)
- `max_debt_to_income_ratio` (number) - Maximum DTI ratio (as decimal, e.g., 0.43 for 43%)
- `min_dscr` (number) - Minimum Debt Service Coverage Ratio (for commercial)

---

#### Tab 4: Program Details

**Overview & Descriptions:**
- `details_about_mortgage_loan_program` (wysiwyg) - Comprehensive details about the program
- `requirements` (wysiwyg) - Specific requirements for this program
- `what_are` (wysiwyg) - Explanation of what this type of loan is
- `benefits_of` (wysiwyg) - Key benefits of this program
- `how_to_qualify_for` (wysiwyg) - Steps to qualify for this program
- `why_us` (wysiwyg) - Why borrowers should choose this program from CMRE
- `Program_FAQ` (wysiwyg) - Frequently asked questions about this program

---

#### Tab 5: Property & Loan Details

**Property Eligibility:**
- `property_types_residential` (select multiple) - Eligible residential property types:
  - Single Family, Condo, Townhome, Multi-Unit 2-4, Multi-Unit 5+, Manufactured, Modular
- `property_types_commercial` (select multiple) - Eligible commercial property types:
  - Office, Retail, Industrial, Multi-Family, Hotel, Restaurant, Self Storage, Gas Station
- `occupancy` (select multiple) - Eligible occupancy types:
  - Owner Occupied, Investment Property, Investor
- `lien_position` (select multiple) - Eligible lien positions:
  - 1st, 2nd, 3rd
- `amortization_terms` (select multiple) - Available amortization periods:
  - 5, 10, 15, 20, 25, 30, 40 years, ARM

**Loan Characteristics:**
- `income_documentation_type` (select multiple) - Accepted income documentation types:
  - 1099, 2yr Tax Returns, 2yr Bank Statements, W2, Paystubs, Profit and Loss, No Documentation, Asset Qualification
- `purpose_of_mortgage` (select multiple) - Eligible mortgage purposes:
  - Purchase, Refinance, Cash-Out Refinance, Construction, Bridge, Investment
- `refinance_mortgage` (select multiple) - Types of refinances eligible:
  - Rate and Term, Cash-Out, FHA Streamline, VA IRRRL, USDA Streamline

---

#### Tab 6: Borrower Details

- `borrower_type` (select multiple) - Eligible borrower types:
  - Individual, Self-Employed, Business Owner, Foreign National, LLC, Corporation
- `citizenship` (select multiple) - Citizenship/residency requirements:
  - US Citizen, Permanent Resident, Foreign National
- `credit_event` (select multiple) - Acceptable credit history scenarios:
  - No Credit Event, Bankruptcy, Foreclosure, Short Sale, Deed in Lieu, Late Payments
- `mortgage_lates` (select multiple) - Acceptable mortgage payment history:
  - No Lates, 30 Day Late, 60 Day Late, 90 Day Late
- `lenders_info` (acfe_dynamic_render) - Dynamically generated lender information

---

#### How This Single Entity Works

**When `is_local_variation` = false (National Program):**
- Location Information tab is hidden
- Program is displayed on homepage, directory pages, and any page needing national programs

**When `is_local_variation` = true (Local Program):**
- Location Information tab is shown with auto-generated city/region data
- Program is displayed on service location pages for that specific market
- All other tabs can have location-specific overrides of program details

**Key Benefit:** One ACF field group manages both national and local programs. Pages query `Program` posts and filter by `is_local_variation` flag as needed.

### Funded Loan
**WordPress CPT:** `funded-loan`
**ACF Field Group:** FundedLoans (ID: 7501)
**Schema.org:** LoanOrCredit + NewsArticle

A completed transaction used for social proof.

**Key Fields:**
- **Program & Borrower:** `name_of_program_funded`, `program_type_funded`, `borrower_type`
- **Property:** `property_types_residential/commercial`, `location_of_property`
- **Transaction:**
  - `funded_loan_amount`, `interest_rate`
  - `ltv`, `credit_score`, `debt_to_income_ratio`, `funded_dscr`
- **Story:** `what_is_this_funded_mortgage`, `transaction_details`, `borrower_story`
- **Media:** `property_image_2`, `property_image_3`, etc.

### Service Location
**WordPress CPT:** `local-city-page` (or custom)
**Schema.org:** LocalBusiness

A market-specific landing page.

**Key Fields:**
- `location_name` (City/Region)
- `description`, `demographics`
- `office_address`
- Relationships: `featured_programs`, `featured_funded_loans`, `local_testimonials`

### Testimonial / Review
**Schema.org:** Review

**Key Fields:**
- `borrower_name`, `testimonial_text`, `rating` (1-5)
- `loan_program`, `property_location`

### Team Member
**Schema.org:** Person

**Key Fields:**
- `full_name`, `title`, `bio`, `photo`, `credentials`
- `specialization` (Programs)

### Partner
**Schema.org:** Organization

**Key Fields:**
- `partner_name`, `partner_type`, `description`, `logo`, `website`

## Relationships

- **Program** has many **Funded Loans** (each deal uses a specific program)
- **Program** has many **Testimonials** (customer reviews for the program)
- **Service Location** displays many **Programs** (both national and local variations for that market)
- **Service Location** displays many **Funded Loans** (completed deals in that location)
- **Service Location** displays many **Testimonials** (reviews from that location)
- **Funded Loan** belongs to one **Program**
- **Funded Loan** belongs to one **Service Location**
- **Testimonial** belongs to one **Program**
- **Testimonial** belongs to one **Service Location**

## Taxonomies & Shared Field Options

**Program Type Taxonomy:**
- Residential, Commercial, Hard Money, NonQM, Reverse Mortgage

**Property Types:**
- SFR, Condo, Townhouse, Multi-Family, Mixed Use, Land, Industrial, Retail, Office

**Borrower Types:**
- Individual, Self-Employed, Business Entity, Foreign National

## AI & Search Engine Optimization Strategy

### Schema.org Markup
- **FinancialProduct**: Loan Programs
- **LoanOrCredit**: Funded Loans
- **LocalBusiness**: Service Locations / Local Programs
- **Person**: Team Members
- **Review**: Testimonials
